{% extends 'base.html' %}
{% block content %}
{% load static %}
<form method="POST" action="http://mail.koreadigitalpark.com/mail_api/token_sso" target="_blank">
    <input type="text" name="api_key" id="api_key" value="#yhwh141935!">
    <input type="text" name="host_domain" id="host_domain" value="koreadigitalpark.com">
    <input type="text" name="data" id="data" value="koreadigitalpark.com">
    <input type="button" id="btnOK" value="email">
</form>
{% endblock %}

{% block script %}
<script type='text/javascript'>
var token = "";
function makeid()
{
	var text = "";
	var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
	for( var i=0; i < 40; i++ )
		text += possible.charAt(Math.floor(Math.random() * possible.length));
	return text;
}

$(function(){
	token = makeid();
	$("#data").val('{"cid":"mailtest", "MailToken":"' + token + '"}')
});
$("#btnOK").click(function(){
	$.ajax({
		type : "POST",
		dataType : "json",
		url : "http://mail.koreadigitalpark.com/mail_api/token_sso",
		data : {
			"api_key" : $("#api_key").val(),
			"host_domain" : $("#host_domain").val(),
			"data" : $("#data").val(),
		},
		success:function(data){
			console.log(data);
			var date = new Date();
			date.setTime(date.getTime() + (10 * 1000));
			$.cookie('MailToken' , token, {expires: date, path: "/", domain: ".도메인(kosekorea.co.kr)"});
			window.open('http://mail.koreadigitalpark.com/lw_api/token_sso/'+ token + '?return_url=%2Fwebmail%2Fwrite', 'MAIL', '');
		},
		error:function(e){
			alert(e.responseText);
		}
	});
});

</script>
{% endblock %}